{% extends "base.html" %}

{% block title %}Welcome to ITSM Agent{% endblock %}

{% block content %}
    <!-- Hero Section -->
    <div class="hero bg-base-100 rounded-2xl shadow-xl overflow-hidden mb-8">
        <div class="hero-content text-center p-12">
            <div class="max-w-2xl">
                <h1 class="text-5xl font-bold">ITSM Agent</h1>
                <p class="py-6 text-lg opacity-70">
                    A powerful AI agent for Change Management and ITSM automation.
                    Built with <span class="badge badge-secondary">LangGraph</span>, <span class="badge badge-primary">FastAPI</span>, and <span class="badge badge-accent">DaisyUI</span>.
                </p>
            </div>
        </div>
    </div>
    
    <div x-data="{ streamStatus: 'online' }"
         @htmx:sse-error.window="streamStatus = 'offline'"
         @htmx:sse-open.window="streamStatus = 'online'">
        
        <div class="card bg-base-100 shadow-xl border border-base-300">
            <div class="card-body">
                <h2 class="card-title text-primary">Recent Evaluations</h2>
                <div id="evaluations-container" 
                     hx-ext="sse" 
                     sse-connect="/api/v1/evaluations/sse-stream" 
                     sse-swap="eval-update"
                     class="min-h-[200px]">
                    {% include "components/evaluations_list.html" %}
                </div>
            </div>
        </div>

        <!-- Subtle status line outside the card -->
        <div class="mt-3 px-6 flex items-center justify-between text-[10px] uppercase tracking-widest opacity-30">
            <!-- Evaluation Stream Status -->
            <div class="flex items-center gap-2">
                <div class="w-1.5 h-1.5 rounded-full"
                     :class="streamStatus === 'online' ? 'bg-success animate-pulse' : 'bg-error'"></div>
                <span x-text="streamStatus === 'online' ? 'Stream' : 'Offline'">Stream</span>
            </div>

            <!-- API System Life Indicator -->
            <div class="flex items-center gap-3" 
                 x-data="{ 
                    apiStatus: 'unknown',
                    async check() {
                        try {
                            const resp = await fetch('/api/v1/health');
                            if (!resp.ok) throw new Error();
                            const data = await resp.json();
                            this.apiStatus = data.status;
                        } catch (e) {
                            this.apiStatus = 'offline';
                        }
                    }
                 }"
                 x-init="check(); setInterval(() => check(), 30000)">
                <div class="flex items-center gap-1.5">
                    <span class="opacity-70">Core System</span>
                    <div class="w-1.5 h-1.5 rounded-full transition-all duration-700"
                         :class="{
                            'bg-success shadow-[0_0_8px_rgba(34,197,94,0.6)]': apiStatus === 'ok',
                            'bg-error animate-pulse shadow-[0_0_8px_rgba(239,68,68,0.6)]': apiStatus !== 'ok' && apiStatus !== 'unknown',
                            'bg-neutral': apiStatus === 'unknown'
                         }"></div>
                    
                    <!-- Status Labels -->
                    <span x-show="apiStatus === 'ok'" class="text-[8px] opacity-60 text-success">OK</span>
                    <span x-show="apiStatus !== 'ok' && apiStatus !== 'unknown'" 
                          class="text-[8px] opacity-100 text-error font-bold" 
                          x-text="apiStatus === 'offline' ? 'OFFLINE' : 'FAIL'"></span>
                </div>
                <span>ITSM AGENT</span>
            </div>
        </div>
    </div>
{% endblock %}
